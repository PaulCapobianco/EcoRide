<?php declare(strict_types=1); ?>
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EcoRide — Publier un trajet</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <script defer type="module" src="assets/js/main.js"></script>
</head>
<body>
  <?php require_once __DIR__ . '/includes/header.phtml'; ?>

  <main class="page">
    <section class="search-bar" aria-label="Publier un trajet">
      <div class="layout-container">
        <div class="search-card">
          <h1 class="section-title mb-3">Publier un trajet</h1>

          <form class="row g-4" action="#" method="post" novalidate>
            <div class="col-12">
              <h2 class="h5 mb-2">Itinéraire</h2>
              <div class="row g-3 align-items-end">
                <div class="col-md-5">
                  <label for="from" class="form-label">Ville de départ</label>
                  <input id="from" name="from" type="text" class="form-control" placeholder="Ex : Lyon" required />
                </div>

                <div class="col-auto d-none d-md-block">
                  <button type="button" class="swap-btn" id="swapCities" aria-label="Inverser départ et arrivée" title="Inverser">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M7 7h10M7 7l2.5-2.5M7 7l2.5 2.5M17 17H7M17 17l-2.5-2.5M17 17l-2.5 2.5"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>

                <div class="col-md-5">
                  <label for="to" class="form-label">Ville d'arrivée</label>
                  <input id="to" name="to" type="text" class="form-control" placeholder="Ex : Grenoble" required />
                </div>

                <div class="col-12 col-md-3">
                  <label for="date" class="form-label">Date</label>
                  <input id="date" name="date" type="date" class="form-control" required />
                </div>
                <div class="col-6 col-md-3">
                  <label for="timeStart" class="form-label">Heure départ</label>
                  <input id="timeStart" name="timeStart" type="time" class="form-control" required />
                </div>
                <div class="col-6 col-md-3">
                  <label for="timeEnd" class="form-label">Heure arrivée (optionnel)</label>
                  <input id="timeEnd" name="timeEnd" type="time" class="form-control" />
                </div>
              </div>
            </div>

            <div class="col-12">
              <h2 class="h5 mb-2">Détails</h2>
              <div class="row g-3">
                <!-- ▼ Nouveau : sélection du véhicule -->
                <div class="col-12 col-md-6">
                  <label for="vehicle" class="form-label">Véhicule utilisé</label>
                  <select id="vehicle" name="vehicle" class="form-select" required aria-describedby="vehicleHelp">
                    <option value="" selected disabled>Choisir…</option>
                    <!-- Exemples : mets tes véhicules réels ici -->
                    <option value="veh1" data-energy="hybride">Peugeot 308 — Hybride</option>
                    <option value="veh2" data-energy="electrique">Tesla Model 3 — Électrique</option>
                    <option value="veh3" data-energy="essence">Renault Clio — Essence</option>
                  </select>
                  <div id="vehicleHelp" class="form-text">Les véhicules proviennent de votre profil.</div>
                  <!-- Badge EcoRider (affiché si énergie éco) -->
                  <div id="ecoBadge" class="mt-2 d-none">
                    <span class="badge bg-success">EcoRider</span>
                    <small class="text-muted ms-1">véhicule écologique</small>
                  </div>
                </div>
                <!-- ▲ Nouveau -->

                <div class="col-6 col-md-3">
                  <label for="seats" class="form-label">Places dispo</label>
                  <input id="seats" name="seats" type="number" min="1" max="6" step="1" class="form-control" placeholder="Ex : 3" required />
                </div>
                <div class="col-6 col-md-3">
                  <label for="price" class="form-label">Prix / personne (€)</label>
                  <input id="price" name="price" type="number" min="1" step="1" class="form-control" placeholder="Ex : 12" required />
                </div>
                <div class="col-12 col-md-6">
                  <label for="meeting" class="form-label">Point de rendez-vous (optionnel)</label>
                  <input id="meeting" name="meeting" type="text" class="form-control" placeholder="Adresse précise, station, parking…" />
                </div>
              </div>
            </div>

            <div class="col-12">
              <label for="notes" class="form-label">Message aux passagers (optionnel)</label>
              <textarea id="notes" name="notes" rows="4" class="form-control" placeholder="Infos utiles : pauses, péages, coffre limité…"></textarea>
            </div>

            <div class="col-12">
              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="terms" required />
                <label class="form-check-label" for="terms">
                  J’accepte les conditions d’utilisation et je m’engage à respecter le code de la route.
                </label>
              </div>
              <button type="submit" class="btn btn-success">Publier le trajet</button>
            </div>
          </form>
        </div>
      </div>
    </section>
  </main>

  <?php require_once __DIR__ . '/includes/footer.phtml'; ?>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Front-only : affichage du badge EcoRider selon l'énergie choisie
    (function(){
      const select = document.getElementById('vehicle');
      const badgeWrap = document.getElementById('ecoBadge');
      const ECO_SET = new Set(['electrique','hybride','hydrogene','gnv']); // règle mémorisée

      function toggleBadge(){
        const opt = select.options[select.selectedIndex];
        const energy = (opt && opt.dataset.energy) ? opt.dataset.energy.toLowerCase() : '';
        const isEco = ECO_SET.has(energy);
        badgeWrap.classList.toggle('d-none', !isEco);
      }

      select.addEventListener('change', toggleBadge);
      // si une valeur est déjà présélectionnée (ex. autofill navigateur)
      toggleBadge();
    })();
  </script>
</body>
</html>
